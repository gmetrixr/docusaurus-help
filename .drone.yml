# .drone.yml
kind: pipeline
type: docker
name: default
workspace:
  path: /src
trigger:
  branch: [main]
  event: [push]
steps:
- name: Website
  image: gmetrixr/baseimage:node-16-dev-v1
  commands:
  #Actual deploy related commands
    - sudo chown -R node .
  #Setup git access for git clone to work ($HOME is /home/node)
    - mkdir -p $HOME/.ssh
    - echo -e "Host github.com\n  Hostname ssh.github.com\n  Port 443" >> $HOME/.ssh/config
    - ssh-keyscan -t rsa github.com >> $HOME/.ssh/known_hosts
    - echo "$GITHUB_PRIVATE_KEY > $HOME/.ssh/id_rsa"
    - chmod 0600 $HOME/.ssh/id_rsa
  #Actual deploy related commands
    - cd gmetri-help
    - pnpm install
    - pnpm deploy
  environment:
    USE_SSH: true
    GIT_USER: $DRONE_COMMIT_AUTHOR
    GITHUB_PRIVATE_KEY: git_deploy_private_key_help
